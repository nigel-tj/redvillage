$(function(){function t(){$("#msg_slideshow").unbind("mouseenter").bind("mouseenter",n).andSelf().unbind("mouseleave").bind("mouseleave",e)}function n(){$("#msg_controls").stop().animate({right:"15px"},500)}function e(){$("#msg_controls").stop().animate({right:"-110px"},500)}function i(){a(),$("#msg_pause_play").addClass("msg_pause").removeClass("msg_play"),d=setInterval(a,g)}function s(){$("#msg_pause_play").addClass("msg_play").removeClass("msg_pause"),clearTimeout(d)}function a(){++l,r("r")}function m(){--l,r("l")}function r(t){h();var n=$("#msg_thumbs .msg_thumb_wrapper:nth-child("+o+")").find("a:nth-child("+parseInt(l-_*(o-1))+")").find("img");if(!n.length)return"r"==t?--l:"l"==t&&++l,void h();var e=n.attr("alt"),i=$("#msg_wrapper").find("img");i.length?i.fadeOut(function(){$(this).remove(),$("<img />").load(function(){var t=$(this);c(t),t.hide(),$("#msg_wrapper").empty().append(t.fadeIn())}).attr("src",e)}):$("<img />").load(function(){var t=$(this);c(t),t.hide(),$("#msg_wrapper").empty().append(t.fadeIn())}).attr("src",e)}function h(){$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+o+")").hide(),o=Math.ceil(l/_),o>f?(o=1,l=1):0==o&&(o=f,l=o*_),$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+o+")").show()}function u(){var t=$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+parseInt(o+1)+")");t.length&&$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+o+")").fadeOut(function(){++o,t.fadeIn()})}function p(){var t=$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+parseInt(o-1)+")");t.length&&$("#msg_thumbs").find(".msg_thumb_wrapper:nth-child("+o+")").fadeOut(function(){--o,t.fadeIn()})}function c(t){var n=new Image;n.src=t.attr("src");var e=n.width,i=n.height,s=400,a=400;if(e>s){var m=s,r=e/s,h=i/r;if(h>a){var u=a,p=h/a,c=m/p;n.width=c,n.height=u}else n.width=m,n.height=h}else if(i>a){var h=a,r=i/a,m=e/r;if(m>s){var c=s,p=m/s,u=h/p;n.height=u,n.width=c}else n.width=m,n.height=h}t.css({width:n.width,height:n.height})}var d,g=4e3,l=0,o=0,f=$("#msg_thumbs .msg_thumb_wrapper").length,_=6;i(),t(),$("#msg_grid").bind("click",function(t){e(),$("#msg_slideshow").unbind("mouseenter").unbind("mouseleave"),s(),$("#msg_thumbs").stop().animate({top:"0px"},500),t.preventDefault()}),$("#msg_thumb_close").bind("click",function(e){n(),t(),$("#msg_thumbs").stop().animate({top:"-230px"},500),e.preventDefault()}),$("#msg_pause_play").bind("click",function(t){var n=$(this);n.hasClass("msg_play")?i():s(),t.preventDefault()}),$("#msg_next").bind("click",function(t){s(),a(),t.preventDefault()}),$("#msg_prev").bind("click",function(t){s(),m(),t.preventDefault()}),$("#msg_thumb_next").bind("click",function(t){u(),t.preventDefault()}),$("#msg_thumb_prev").bind("click",function(t){p(),t.preventDefault()}),$("#msg_thumbs .msg_thumb_wrapper > a").bind("click",function(t){var n=$(this);$("#msg_thumb_close").trigger("click");var e=n.index(),i=n.parent().index();l=parseInt(i*_+e+1),r(),t.preventDefault()}).bind("mouseenter",function(){var t=$(this);t.stop().animate({opacity:1})}).bind("mouseleave",function(){var t=$(this);t.stop().animate({opacity:.5})})});