<%# Shared partial for displaying profile cards - works with both profile and user objects %>
<% profile_obj = profile || user&.profile %>
<% user_obj = user || profile&.user %>

<% if profile_obj.present? %>
  <div class="col-xl-4 col-lg-4 col-sm-6 mb-4">
    <div class="card profile-card h-100 border-0 shadow-sm">
      <% if profile_obj.profile_picture_url.present? %>
        <%= link_to profile_path(profile_obj), class: "profile-image-link" do %>
          <div class="card-img-top" style="height: 300px; overflow: hidden; background: #f8f9fa;">
            <%= image_tag profile_obj.profile_picture_url(:medium), alt: profile_obj.display_name, style: "width: 100%; height: 100%; object-fit: cover;" %>
          </div>
        <% end %>
      <% else %>
        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 300px;">
          <i class="fas fa-user fa-5x text-white"></i>
        </div>
      <% end %>
      
      <div class="card-body">
        <h5 class="card-title">
          <%= link_to profile_obj.display_name, profile_path(profile_obj), class: "text-decoration-none text-dark" %>
        </h5>
        <p class="card-text mb-2">
          <small class="text-muted"><%= profile_obj.role_display %></small>
          <% if profile_obj.location.present? %>
            <br><small class="text-muted"><i class="fas fa-map-marker-alt"></i> <%= profile_obj.location %></small>
          <% end %>
        </p>
        
        <% if profile_obj.bio.present? %>
          <p class="card-text small text-muted"><%= truncate(profile_obj.bio, length: 120) %></p>
        <% end %>
        
        <% if profile_obj.has_social_links? %>
          <div class="social-links mt-2">
            <% profile_obj.social_links.each do |platform, url| %>
              <% if url.present? %>
                <% icon_class = case platform.to_s
                     when 'facebook' then 'fab fa-facebook-f'
                     when 'twitter' then 'fab fa-twitter'
                     when 'instagram' then 'fab fa-instagram'
                     when 'linkedin' then 'fab fa-linkedin'
                     when 'youtube' then 'fab fa-youtube'
                     when 'spotify' then 'fab fa-spotify'
                     when 'soundcloud' then 'fab fa-soundcloud'
                     when 'pinterest' then 'fab fa-pinterest'
                     when 'tiktok' then 'fab fa-tiktok'
                   else 'fab fa-link'
                   end %>
                <%= link_to url, target: "_blank", rel: "noopener", class: "btn btn-sm btn-outline-secondary me-1 mb-1", title: platform.to_s.titleize do %>
                  <i class="<%= icon_class %>"></i>
                <% end %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
      
      <div class="card-footer bg-white border-top">
        <%= link_to "View Profile", profile_path(profile_obj), class: "btn btn-primary btn-sm w-100" %>
      </div>
    </div>
  </div>
<% end %>

