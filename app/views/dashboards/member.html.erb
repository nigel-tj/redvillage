<div class="container-fluid mt-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-2">Welcome back, <%= current_user.name %>!</h1>
          <p class="text-muted mb-0">Manage your tickets and explore the marketplace</p>
        </div>
        <%= link_to new_ticket_listing_path, class: "btn btn-primary btn-lg" do %>
          <i class="fas fa-plus-circle"></i> List Your Tickets
        <% end %>
      </div>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card border-primary shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <i class="fas fa-ticket-alt fa-2x text-primary"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <h3 class="mb-0"><%= @available_count %></h3>
              <p class="text-muted mb-0">Available Listings</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-success shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <i class="fas fa-check-circle fa-2x text-success"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <h3 class="mb-0"><%= @sold_count %></h3>
              <p class="text-muted mb-0">Sold Listings</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-warning shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <i class="fas fa-dollar-sign fa-2x text-warning"></i>
            </div>
            <div class="flex-grow-1 ms-3">
              <h3 class="mb-0">$<%= sprintf('%.2f', @total_revenue) %></h3>
              <p class="text-muted mb-0">Total Revenue</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- My Listings -->
    <div class="col-lg-7 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="fas fa-list"></i> My Recent Listings
          </h5>
          <%= link_to my_tickets_path, class: "btn btn-sm btn-outline-primary" do %>
            View All
          <% end %>
        </div>
        <div class="card-body">
          <% if @ticket_listings.any? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Event</th>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @ticket_listings.each do |listing| %>
                    <tr>
                      <td>
                        <strong><%= listing.event.name %></strong>
                        <br>
                        <small class="text-muted">
                          <%= time_ago_in_words(listing.created_at) %> ago
                        </small>
                      </td>
                      <td>
                        <% if listing.ticket_type == 'vip' %>
                          <span class="badge bg-warning text-dark">VIP</span>
                        <% else %>
                          <span class="badge bg-primary">Standard</span>
                        <% end %>
                      </td>
                      <td><strong><%= listing.formatted_price %></strong></td>
                      <td>
                        <% case listing.status %>
                        <% when 'available' %>
                          <span class="badge bg-success">Available</span>
                        <% when 'sold' %>
                          <span class="badge bg-danger">Sold</span>
                        <% else %>
                          <span class="badge bg-secondary"><%= listing.status.titleize %></span>
                        <% end %>
                      </td>
                      <td>
                        <%= link_to ticket_listing_path(listing), class: "btn btn-sm btn-outline-primary" do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="text-center py-4">
              <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
              <p class="text-muted">You haven't created any listings yet.</p>
              <%= link_to new_ticket_listing_path, class: "btn btn-primary" do %>
                <i class="fas fa-plus"></i> Create Your First Listing
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Marketplace & Upcoming Events -->
    <div class="col-lg-5">
      <!-- Marketplace Preview -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-store"></i> Ticket Marketplace
          </h5>
        </div>
        <div class="card-body">
          <% if @marketplace_tickets.any? %>
            <% @marketplace_tickets.take(3).each do |listing| %>
              <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
                <div class="flex-shrink-0">
                  <% if listing.ticket_type == 'vip' %>
                    <i class="fas fa-star fa-2x text-warning"></i>
                  <% else %>
                    <i class="fas fa-ticket-alt fa-2x text-primary"></i>
                  <% end %>
                </div>
                <div class="flex-grow-1 ms-3">
                  <strong class="d-block"><%= listing.event.name %></strong>
                  <small class="text-muted">
                    <%= listing.formatted_price %> â€¢ <%= listing.available_quantity %> left
                  </small>
                </div>
                <div>
                  <%= link_to ticket_listing_path(listing), class: "btn btn-sm btn-outline-primary" do %>
                    <i class="fas fa-eye"></i>
                  <% end %>
                </div>
              </div>
            <% end %>
            <%= link_to ticket_listings_path, class: "btn btn-primary w-100" do %>
              <i class="fas fa-search"></i> Browse Marketplace
            <% end %>
          <% else %>
            <p class="text-muted text-center">No tickets available yet.</p>
          <% end %>
        </div>
      </div>

      <!-- Upcoming Events -->
      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="fas fa-calendar-alt"></i> Upcoming Events
          </h5>
        </div>
        <div class="card-body">
          <% if @upcoming_events.any? %>
            <% @upcoming_events.each do |event| %>
              <div class="mb-3 pb-3 border-bottom">
                <strong class="d-block"><%= event.name %></strong>
                <small class="text-muted">
                  <% if event.date %>
                    <i class="fas fa-calendar"></i> <%= event.date.strftime("%b %d, %Y") %>
                  <% end %>
                  <% if event.venue %>
                    <br><i class="fas fa-map-marker-alt"></i> <%= event.venue %>
                  <% end %>
                </small>
                <div class="mt-2">
                  <%= link_to new_event_ticket_listing_path(event), class: "btn btn-sm btn-outline-primary" do %>
                    <i class="fas fa-plus"></i> Sell Tickets
                  <% end %>
                </div>
              </div>
            <% end %>
            <%= link_to events_path, class: "btn btn-outline-secondary w-100" do %>
              View All Events
            <% end %>
          <% else %>
            <p class="text-muted text-center">No upcoming events.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

