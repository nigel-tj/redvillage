<!-- breadcrump begin -->
<div class="breadcrump">
    <div class="container">
        <div class="row">
            <div class="col-xl-6 col-lg-6">
                <div class="breadcrump-content">
                    <span class="page-name"><%= link_to 'Home', root_path, style: "color: inherit; text-decoration: none;" %></span>
                    <span class="icon"><i class="fas fa-chevron-right"></i></span>
                    <span class="page-name"><%= link_to 'Tickets', ticket_listings_path, style: "color: inherit; text-decoration: none;" %></span>
                    <span class="icon"><i class="fas fa-chevron-right"></i></span>
                    <span class="page-name"><%= @ticket_listing.event.name %></span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcrump end -->

<!-- ticket detail begin -->
<section class="ticket-detail-section" style="background-color: #000B14; color: #fff; padding: 100px 0;">
    <div class="container">
        <div class="row">
            <div class="col-xl-8 col-lg-8">
                <!-- Event Image -->
                <% if @event.image %>
                    <div class="ticket-detail-image mb-4" style="position: relative; height: 400px; border-radius: 10px; overflow: hidden;">
                        <%= image_tag shrine_image_url(@event, :image, :large) || shrine_image_url(@event, :image), style: "width: 100%; height: 100%; object-fit: cover;", alt: @event.name %>
                        <div style="position: absolute; top: 20px; right: 20px;">
                            <% if @ticket_listing.ticket_type == 'vip' %>
                                <span style="background: #ffc107; color: #000; padding: 10px 20px; border-radius: 25px; font-weight: bold;">
                                    <i class="fas fa-star"></i> VIP TICKET
                                </span>
                            <% else %>
                                <span style="background: #0d6efd; color: #fff; padding: 10px 20px; border-radius: 25px; font-weight: bold;">STANDARD TICKET</span>
                            <% end %>
                        </div>
                        <% if @ticket_listing.has_discount? %>
                            <div style="position: absolute; top: 20px; left: 20px;">
                                <span style="background: #dc3545; color: #fff; padding: 10px 20px; border-radius: 25px; font-weight: bold;">
                                    <i class="fas fa-tag"></i> <%= @ticket_listing.discount_percentage %>% OFF
                                </span>
                            </div>
                        <% end %>
                    </div>
                <% end %>

                <!-- Event Info -->
                <div class="ticket-detail-content" style="background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 10px; margin-bottom: 30px;">
                    <h1 style="color: #ff1493; margin-bottom: 20px;"><%= @event.name %></h1>
                    <div style="margin-bottom: 20px;">
                        <% if @event.date %>
                            <p style="margin-bottom: 10px; color: #ccc;">
                                <i class="fas fa-calendar-alt" style="color: #ff1493; margin-right: 10px;"></i> 
                                <strong><%= @event.date.strftime("%A, %B %d, %Y") %></strong>
                            </p>
                        <% end %>
                        <% if @event.venue %>
                            <p style="margin-bottom: 10px; color: #ccc;">
                                <i class="fas fa-map-marker-alt" style="color: #ff1493; margin-right: 10px;"></i> <%= @event.venue %>
                            </p>
                        <% end %>
                        <% if @event.start_time %>
                            <p style="margin-bottom: 0; color: #ccc;">
                                <i class="fas fa-clock" style="color: #ff1493; margin-right: 10px;"></i> <%= @event.formatted_start_time %>
                            </p>
                        <% end %>
                    </div>

                    <% if @ticket_listing.description.present? %>
                        <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <h4 style="color: #fff; margin-bottom: 15px;">About This Listing</h4>
                            <p style="color: #ccc; line-height: 1.8; white-space: pre-wrap;"><%= @ticket_listing.description %></p>
                        </div>
                    <% end %>

                    <!-- Seller Info -->
                    <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <h4 style="color: #fff; margin-bottom: 15px;">Seller Information</h4>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; background: #ff1493; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 24px; font-weight: bold;">
                                <%= @seller.name.first.upcase %>
                            </div>
                            <div>
                                <strong style="color: #fff;"><%= @seller.name %></strong>
                                <p style="color: #ccc; margin: 0; font-size: 14px;">
                                    Member since <%= @seller.created_at.strftime("%B %Y") %>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Event Details -->
                <% if @event.summary.present? %>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 10px;">
                        <h4 style="color: #fff; margin-bottom: 15px;">Event Details</h4>
                        <p style="color: #ccc; line-height: 1.8; white-space: pre-wrap;"><%= @event.summary %></p>
                    </div>
                <% end %>
            </div>

            <div class="col-xl-4 col-lg-4">
                <!-- Purchase Card -->
                <div style="background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 10px; position: sticky; top: 20px;">
                    <h4 style="color: #fff; margin-bottom: 25px;">Purchase Tickets</h4>
                    
                    <div style="margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #ccc;">Available:</span>
                            <strong style="color: <%= @ticket_listing.is_available? ? '#28a745' : '#dc3545' %>">
                                <%= @ticket_listing.available_quantity %> / <%= @ticket_listing.quantity %>
                            </strong>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: <%= (@ticket_listing.sold_quantity.to_f / @ticket_listing.quantity * 100) %>%; background: <%= @ticket_listing.is_available? ? '#28a745' : '#dc3545' %>; transition: width 0.3s ease;"></div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="text-align: center;">
                            <h2 style="color: #ff1493; margin-bottom: 10px; font-size: 48px;"><%= @ticket_listing.formatted_price %></h2>
                            <% if @ticket_listing.has_discount? %>
                                <p style="color: #ccc; text-decoration: line-through; margin-bottom: 5px;">
                                    <%= @ticket_listing.formatted_original_price %>
                                </p>
                            <% end %>
                            <small style="color: #aaa;">per ticket</small>
                        </div>
                    </div>

                    <% if @ticket_listing.is_available? %>
                        <% if user_signed_in? %>
                            <% unless current_user == @ticket_listing.user %>
                                <div style="margin-bottom: 20px;">
                                    <label style="color: #ccc; margin-bottom: 10px; display: block;">Quantity</label>
                                    <select class="form-control" id="ticket-quantity" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff;">
                                        <% (1..[@ticket_listing.available_quantity, 10].min).each do |qty| %>
                                            <option value="<%= qty %>"><%= qty %></option>
                                        <% end %>
                                    </select>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <div style="display: flex; justify-content: space-between; color: #ccc;">
                                        <span>Total:</span>
                                        <strong style="color: #ff1493; font-size: 20px;" id="total-price"><%= @ticket_listing.formatted_price %></strong>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100" style="background: #ff1493; border: none; padding: 15px; font-size: 18px; font-weight: bold; margin-bottom: 20px;" onclick="handlePurchase()">
                                    <i class="fas fa-shopping-cart"></i> Contact Seller
                                </button>
                            <% else %>
                                <div style="background: rgba(255, 193, 7, 0.2); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                                    <i class="fas fa-info-circle"></i> This is your own listing.
                                </div>
                            <% end %>
                        <% else %>
                            <%= link_to new_user_registration_path, class: "btn btn-primary w-100", style: "background: #ff1493; border: none; padding: 15px; font-size: 18px; font-weight: bold; margin-bottom: 15px; text-decoration: none; display: block; text-align: center;" do %>
                                <i class="fas fa-user-plus"></i> Sign Up to Purchase
                            <% end %>
                            <p style="text-align: center; color: #ccc; font-size: 14px; margin: 0;">
                                Already have an account? <%= link_to "Sign in", new_user_session_path, style: "color: #ff1493;" %>
                            </p>
                        <% end %>
                    <% else %>
                        <div style="background: rgba(220, 53, 69, 0.2); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle"></i> This ticket is sold out.
                        </div>
                    <% end %>

                    <div style="padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <small style="color: #aaa;">
                            <i class="fas fa-shield-alt"></i> Secure transaction
                            <br>
                            <i class="fas fa-clock"></i> Listed <%= time_ago_in_words(@ticket_listing.created_at) %> ago
                        </small>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <%= link_to event_ticket_listings_path(@event), class: "btn btn-outline-light w-100", style: "margin-bottom: 10px;" do %>
                        <i class="fas fa-list"></i> View All Tickets for This Event
                    <% end %>
                    <%= link_to ticket_listings_path, class: "btn btn-outline-light w-100" do %>
                        <i class="fas fa-arrow-left"></i> Back to Marketplace
                    <% end %>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- ticket detail end -->

<script>
function handlePurchase() {
    const quantity = document.getElementById('ticket-quantity').value;
    const price = <%= @ticket_listing.price %>;
    const total = (quantity * price).toFixed(2);
    
    alert(`Ready to purchase ${quantity} ticket(s) for ${total} <%= @ticket_listing.currency %>?\n\nThis will connect you with the seller: <%= @seller.name %>\nEmail: <%= @seller.email %>`);
}

document.addEventListener('DOMContentLoaded', function() {
    const quantitySelect = document.getElementById('ticket-quantity');
    if (quantitySelect) {
        quantitySelect.addEventListener('change', function() {
            const quantity = parseInt(this.value);
            const price = <%= @ticket_listing.price %>;
            const total = (quantity * price).toFixed(2);
            document.getElementById('total-price').textContent = '<%= @ticket_listing.currency %> ' + total;
        });
    }
});
</script>

<style>
.ticket-detail-section .form-control {
    background: rgba(255, 255, 255, 0.1) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    color: #fff !important;
}

.ticket-detail-section .form-control option {
    background: #1A1A2E;
    color: #fff;
}
</style>
