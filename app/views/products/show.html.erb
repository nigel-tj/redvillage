<%= storefront_css(@store) %>
<div class="container mt-4">
  <div class="row">
    <div class="col-lg-6">
      <% if @product.product_images.any? %>
        <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <% @product.product_images.ordered.each_with_index do |image, index| %>
              <div class="carousel-item <%= 'active' if index == 0 %>">
                <%= image_tag image.image_url(:large) || image.image, class: "d-block w-100", alt: image.alt_text || @product.name, style: "height: 500px; object-fit: contain; background: #f8f9fa;" %>
              </div>
            <% end %>
          </div>
          <% if @product.product_images.count > 1 %>
            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>
          <% end %>
        </div>
      <% else %>
        <div class="bg-secondary d-flex align-items-center justify-content-center" style="height: 500px;">
          <i class="fas fa-image fa-5x text-white"></i>
        </div>
      <% end %>
    </div>
    
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="card-title"><%= @product.name %></h1>
          
          <div class="mb-3">
            <span class="h3 text-primary"><%= @product.formatted_price %></span>
            <% if @product.has_discount? %>
              <span class="text-muted text-decoration-line-through ms-2 h5"><%= "#{@product.currency}#{sprintf('%.2f', @product.compare_at_price)}" %></span>
              <span class="badge bg-danger ms-2">Save <%= @product.discount_percentage %>%</span>
            <% end %>
          </div>
          
          <div class="mb-3">
            <% if @product.in_stock? %>
              <span class="badge bg-success fs-6">In Stock (<%= @product.inventory_quantity %> available)</span>
            <% else %>
              <span class="badge bg-danger fs-6">Out of Stock</span>
            <% end %>
            <% if @product.featured? %>
              <span class="badge bg-warning text-dark fs-6">Featured</span>
            <% end %>
          </div>
          
          <div class="mb-4">
            <h5>Description</h5>
            <p class="text-muted"><%= simple_format(@product.description) %></p>
          </div>
          
          <% if @product.in_stock? %>
            <%= form_with url: add_item_store_cart_path(@store), method: :post, local: true, class: "mb-3" do |f| %>
              <%= f.hidden_field :product_id, value: @product.id %>
              <div class="row align-items-center">
                <div class="col-auto">
                  <label class="form-label">Quantity</label>
                  <%= f.number_field :quantity, value: 1, min: 1, max: @product.inventory_quantity, class: "form-control", style: "width: 80px;" %>
                </div>
                <div class="col-auto">
                  <%= f.submit "Add to Cart", class: "btn btn-primary btn-lg mt-4" %>
                </div>
              </div>
            <% end %>
          <% else %>
            <button class="btn btn-secondary btn-lg w-100" disabled>Out of Stock</button>
          <% end %>
          
          <% if user_signed_in? && (@store.owner?(current_user) || current_user.admin?) %>
            <hr>
            <div class="d-grid gap-2">
              <%= link_to edit_store_product_path(@store, @product), class: "btn btn-outline-primary" do %>
                <i class="fas fa-edit me-1"></i> Edit Product
              <% end %>
              <%= link_to store_product_path(@store, @product), method: :delete, class: "btn btn-outline-danger",
                  confirm: "Are you sure you want to delete this product?" do %>
                <i class="fas fa-trash me-1"></i> Delete Product
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  
  <% if @related_products.any? %>
    <div class="row mt-5">
      <div class="col-12">
        <h3>Related Products</h3>
        <div class="row">
          <% @related_products.limit(4).each do |product| %>
            <div class="col-md-3 mb-4">
              <div class="card h-100">
                <% if product.primary_image %>
                  <%= link_to store_product_path(@store, product) do %>
                    <div style="height: 150px; overflow: hidden;">
                      <%= image_tag product.primary_image.image, alt: product.name, style: "width: 100%; height: 100%; object-fit: cover;" %>
                    </div>
                  <% end %>
                <% end %>
                <div class="card-body">
                  <h6><%= link_to product.name, store_product_path(@store, product) %></h6>
                  <p class="text-primary mb-0"><%= product.formatted_price %></p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

